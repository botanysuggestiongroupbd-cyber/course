<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Video Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8f9fa;
            --dark-color: #1e293b;
            --gray-color: #6b7280;
            --purple-color: #8b5cf6;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .card {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 100%;
            margin-bottom: 20px;
        }

        .card-header {
            background-color: var(--purple-color);
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .card-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-avatar {
            width: 36px;
            height: 36px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .user-status {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 6px 10px;
            border-radius: 50px;
            font-size: 0.85rem;
        }

        .card-content {
            padding: 20px;
        }

        .section {
            background-color: #f9fafb;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .section h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section h3 i {
            color: var(--purple-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .input-container {
            position: relative;
        }

        input, textarea, select {
            width: 100%;
            padding: 14px 14px 14px 42px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            resize: vertical;
            background-color: white;
        }

        textarea {
            min-height: 120px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--purple-color);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        textarea + .input-icon {
            top: 24px;
            transform: none;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: var(--purple-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: #22c55e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.3);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background-color: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-logout {
            background-color: var(--dark-color);
            color: white;
        }

        .btn-logout:hover {
            background-color: #0f172a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 41, 59, 0.3);
        }

        .btn-back {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-back:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 114, 128, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex: 1;
            min-width: 80px;
        }

        .action-btn-sm {
            padding: 6px 10px;
            font-size: 0.8rem;
        }

        .btn-move {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-move:hover {
            background-color: #0ea5e9;
        }

        .btn-move:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
        }

        .btn-hide {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-hide:hover {
            background-color: #d97706;
        }

        .btn-show {
            background-color: var(--success-color);
            color: white;
        }

        .btn-show:hover {
            background-color: #16a34a;
        }

        .btn-view {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-view:hover {
            background-color: #1d4ed8;
        }

        .btn-edit {
            background-color: #f59e0b;
            color: white;
        }

        .btn-edit:hover {
            background-color: #d97706;
        }

        .message {
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 18px;
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .message-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 5px solid var(--success-color);
        }

        .message-error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 5px solid var(--danger-color);
        }

        .message-info {
            background-color: #dbeafe;
            color: #1e40af;
            border-left: 5px solid var(--primary-color);
        }

        .message-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 5px solid var(--warning-color);
        }

        .hidden {
            display: none !important;
        }

        .video-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .video-card.hidden-video {
            opacity: 0.6;
            border-color: var(--warning-color);
            background-color: #fef3c7;
        }

        .video-card-header {
            background-color: var(--purple-color);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .video-card-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .video-card-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .video-card-content {
            padding: 20px;
        }

        .video-preview {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .video-preview iframe {
            width: 100%;
            height: 100%;
            min-height: 200px;
            border: none;
            border-radius: 4px;
        }

        .no-video {
            text-align: center;
            color: var(--gray-color);
        }

        .no-video i {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .video-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }

        .video-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--gray-color);
        }

        .video-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sortable-container {
            position: relative;
        }

        .sortable-handle {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: move;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        .view-modal {
            background-color: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .view-modal-header {
            background-color: var(--dark-color);
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .view-modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .view-modal-content {
            padding: 0;
        }

        .view-modal-video {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: #000;
            position: relative;
        }

        .view-modal-video iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .view-modal-info {
            padding: 20px;
        }

        .login-container {
            max-width: 500px;
            margin: 50px auto;
        }

        .login-container .card {
            text-align: center;
        }

        .login-icon {
            font-size: 3rem;
            color: var(--purple-color);
            margin-bottom: 15px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            width: 100%;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .stat-icon.videos {
            background-color: var(--purple-color);
        }

        .stat-icon.public {
            background-color: var(--success-color);
        }

        .stat-icon.hidden {
            background-color: var(--warning-color);
        }

        .stat-icon.views {
            background-color: var(--accent-color);
        }

        .stat-content h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .stat-content p {
            color: var(--gray-color);
            font-size: 0.85rem;
        }

        .footer {
            margin-top: 20px;
            color: white;
            text-align: center;
            opacity: 0.8;
            font-size: 0.85rem;
            padding: 0 15px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-hidden {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-public {
            background-color: var(--success-color);
            color: white;
        }

        .mobile-form-row {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Unmute button */
        .unmute-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
            font-weight: 600;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }

        .unmute-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
        }

        .sound-message {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Responsive Design */
        @media (min-width: 481px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .btn {
                width: auto;
            }
            
            .video-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .card-header {
                padding: 22px 25px;
            }
            
            .card-header h2 {
                font-size: 1.6rem;
            }
            
            .card-content {
                padding: 25px;
            }
            
            .section {
                padding: 22px;
            }
            
            .section h3 {
                font-size: 1.3rem;
            }
            
            .mobile-form-row {
                flex-direction: row;
                gap: 20px;
            }
            
            .mobile-form-row .form-group {
                flex: 1;
            }
            
            .stats-container {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                margin-bottom: 25px;
            }
            
            .video-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .card-header {
                padding: 25px 30px;
            }
            
            .card-header h2 {
                font-size: 1.8rem;
            }
            
            .card-content {
                padding: 30px;
            }
            
            .section {
                padding: 25px;
            }
            
            .video-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.6rem;
            }
            
            .card-header h2 {
                font-size: 1.2rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .admin-info {
                width: 100%;
                justify-content: center;
            }
            
            .video-actions {
                flex-direction: column;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .unmute-button {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .sound-message {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
        
        /* Drag and Drop */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #e5e7eb;
        }
        
        .sortable-chosen {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .sortable-drag {
            transform: rotate(5deg);
        }
        
        /* Video Form Guide */
        .guide {
            background-color: #f0f9ff;
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .guide h4 {
            color: var(--dark-color);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .guide ul {
            padding-left: 20px;
            font-size: 0.9rem;
            color: var(--gray-color);
        }
        
        .guide li {
            margin-bottom: 5px;
        }
        
        .guide code {
            background-color: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85rem;
        }

        /* Loading Spinner */
        .loading-spinner {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2rem;
        }

        .loading-spinner i {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        
        /* Link preview */
        .link-preview {
            background-color: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .link-preview.active {
            display: block;
        }
        
        .link-preview h4 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: var(--dark-color);
        }
        
        .link-preview p {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading Screen (Visible while checking auth) -->
        <div id="loadingSection" class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Checking authentication...</p>
        </div>
        
        <!-- Login Section (Visible when not logged in) -->
        <div id="loginSection" class="login-container hidden">
            <div class="card">
                <div class="card-header">
                    <h2>Access Required</h2>
                </div>
                <div class="card-content">
                    <div class="section">
                        <div class="login-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        
                        <div id="loginMessage" class="message"></div>
                        
                        <p style="text-align: center; margin-bottom: 20px; color: var(--gray-color);">
                            You need to be logged in as Admin to access Video Management.
                        </p>
                        
                        <button id="backToAdminBtn" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Go to Admin Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Dashboard (Visible when logged in) -->
        <div id="dashboardSection" class="hidden">
            <div class="header">
                <h1><i class="fas fa-video"></i> Video Management</h1>
                <p>Manage and organize your video content</p>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon videos">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalVideos">0</h3>
                        <p>Total Videos</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon public">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="publicVideos">0</h3>
                        <p>Public Videos</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon hidden">
                        <i class="fas fa-eye-slash"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="hiddenVideos">0</h3>
                        <p>Hidden Videos</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon views">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalViews">0</h3>
                        <p>Total Views</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 id="dashboardTitle">Video Management</h2>
                    <div class="admin-info">
                        <div class="admin-avatar">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="user-status">
                            <i class="fas fa-user-circle"></i>
                            <span id="adminEmail">admin@example.com</span>
                            <span id="adminRoleDisplay"></span>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <div id="dashboardMessage" class="message"></div>
                    
                    <div class="section" id="addVideoSection">
                        <h3><i class="fas fa-plus-circle"></i> Add New Video</h3>
                        
                        <div class="guide">
                            <h4><i class="fas fa-info-circle"></i> How to add YouTube Videos:</h4>
                            <ul>
                                <li>Option 1: Paste YouTube Link (e.g., https://youtu.be/gXFhPCIAtZE)</li>
                                <li>Option 2: Paste YouTube Embed Code (iframe)</li>
                                <li>The system will automatically convert links to embed code</li>
                                <li>Supported formats: youtu.be, youtube.com/watch, youtube.com/embed</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label for="videoTitle">Video Title *</label>
                            <div class="input-container">
                                <i class="fas fa-heading input-icon"></i>
                                <input type="text" id="videoTitle" placeholder="Enter video title" maxlength="200">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="videoLinkOrEmbedCode">YouTube Link or Embed Code *</label>
                            <div class="input-container">
                                <i class="fas fa-link input-icon"></i>
                                <textarea id="videoLinkOrEmbedCode" placeholder="Paste YouTube link (e.g., https://youtu.be/gXFhPCIAtZE) or embed code here..."></textarea>
                            </div>
                        </div>
                        
                        <div id="linkPreview" class="link-preview">
                            <h4>Preview:</h4>
                            <p id="previewStatus"></p>
                            <div id="previewThumbnail" style="width: 100%; max-width: 300px; margin-top: 10px;">
                                <!-- Thumbnail preview will appear here -->
                            </div>
                        </div>
                        
                        <div class="mobile-form-row">
                            <div class="form-group">
                                <label for="videoCategory">Category (Optional)</label>
                                <div class="input-container">
                                    <i class="fas fa-tag input-icon"></i>
                                    <input type="text" id="videoCategory" placeholder="e.g., Tutorial, Music, Gaming">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="videoStatus">Initial Status</label>
                                <div class="input-container">
                                    <i class="fas fa-eye input-icon"></i>
                                    <select id="videoStatus">
                                        <option value="public">Public (Everyone can view)</option>
                                        <option value="hidden">Hidden (Only admin can view)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <button id="addVideoBtn" class="btn btn-success">
                            <i class="fas fa-plus-circle"></i> Add Video
                        </button>
                    </div>
                    
                    <div class="section" id="manageVideosSection">
                        <h3><i class="fas fa-list"></i> Manage Videos <small>(Drag to reorder)</small></h3>
                        
                        <div id="videosContainer" class="video-grid">
                            <!-- Videos will be loaded here -->
                        </div>
                        
                        <div id="noVideosMessage" class="hidden">
                            <div class="no-video" style="padding: 40px;">
                                <i class="fas fa-video-slash" style="font-size: 4rem;"></i>
                                <h3>No Videos Yet</h3>
                                <p>Add your first video using the form above!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="text-align: center; margin-top: 20px;">
                        <button id="backToAdminBtn2" class="btn btn-back" style="margin-right: 10px;">
                            <i class="fas fa-arrow-left"></i> Back to Admin Panel
                        </button>
                        <button id="logoutBtn" class="btn btn-logout">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View Video Modal -->
        <div id="viewModal" class="view-modal-overlay hidden">
            <div class="view-modal">
                <div class="view-modal-header">
                    <h3 id="viewModalTitle"></h3>
                    <button class="modal-close" id="closeViewModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="view-modal-content">
                    <div class="view-modal-video" id="viewModalVideo">
                        <!-- Video will be loaded here -->
                    </div>
                    <div class="view-modal-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span id="viewModalCategory" class="badge" style="background-color: var(--gray-color); color: white;"></span>
                                <span id="viewModalStatus" class="badge badge-public" style="margin-left: 8px;"></span>
                            </div>
                            <div style="color: var(--gray-color);">
                                <i class="fas fa-eye"></i> Views: <span id="viewModalViews">0</span>
                            </div>
                        </div>
                        <p id="viewModalDescription"></p>
                        <div style="margin-top: 20px; font-size: 0.9rem; color: var(--gray-color);">
                            <i class="fas fa-calendar"></i> Added on: <span id="viewModalDate"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Edit Video Modal -->
        <div id="editModal" class="view-modal-overlay hidden">
            <div class="view-modal" style="max-width: 700px;">
                <div class="view-modal-header">
                    <h3><i class="fas fa-edit"></i> Edit Video</h3>
                    <button class="modal-close" id="closeEditModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="view-modal-content" style="padding: 20px;">
                    <div id="editModalMessage" class="message"></div>
                    
                    <div class="form-group">
                        <label for="editVideoTitle">Video Title</label>
                        <div class="input-container">
                            <i class="fas fa-heading input-icon"></i>
                            <input type="text" id="editVideoTitle" placeholder="Enter video title">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editVideoEmbedCode">YouTube Link or Embed Code</label>
                        <div class="input-container">
                            <i class="fas fa-link input-icon"></i>
                            <textarea id="editVideoEmbedCode" placeholder="Paste YouTube link or embed code here..." rows="4"></textarea>
                        </div>
                    </div>
                    
                    <div id="editLinkPreview" class="link-preview">
                        <h4>Preview:</h4>
                        <p id="editPreviewStatus"></p>
                    </div>
                    
                    <div class="mobile-form-row">
                        <div class="form-group">
                            <label for="editVideoCategory">Category</label>
                            <div class="input-container">
                                <i class="fas fa-tag input-icon"></i>
                                <input type="text" id="editVideoCategory" placeholder="e.g., Tutorial, Music, Gaming">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="editVideoStatus">Status</label>
                            <div class="input-container">
                                <i class="fas fa-eye input-icon"></i>
                                <select id="editVideoStatus">
                                    <option value="public">Public</option>
                                    <option value="hidden">Hidden</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px; text-align: right;">
                        <button id="cancelEditBtn" class="btn btn-back" style="margin-right: 10px;">
                            Cancel
                        </button>
                        <button id="saveEditBtn" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Video Management System &copy; 2024 | Powered by Firebase</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            getDocs,
            doc,
            setDoc,
            updateDoc,
            deleteDoc,
            getDoc,
            serverTimestamp,
            onSnapshot,
            query,
            orderBy
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAJn31foXlB5ooSIdZ1aGcshMu955urDQo",
            authDomain: "fouth-year.firebaseapp.com",
            projectId: "fouth-year",
            storageBucket: "fouth-year.firebasestorage.app",
            messagingSenderId: "771603556892",
            appId: "1:771603556892:web:51ae0bd68acf6678a14dd9",
            measurementId: "G-XWWT64FGJR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const loadingSection = document.getElementById('loadingSection');
        const loginSection = document.getElementById('loginSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const backToAdminBtn = document.getElementById('backToAdminBtn');
        const backToAdminBtn2 = document.getElementById('backToAdminBtn2');
        const logoutBtn = document.getElementById('logoutBtn');
        const addVideoBtn = document.getElementById('addVideoBtn');
        const loginMessage = document.getElementById('loginMessage');
        const dashboardMessage = document.getElementById('dashboardMessage');
        const adminEmail = document.getElementById('adminEmail');
        const adminRoleDisplay = document.getElementById('adminRoleDisplay');
        const videosContainer = document.getElementById('videosContainer');
        const noVideosMessage = document.getElementById('noVideosMessage');
        const viewModal = document.getElementById('viewModal');
        const closeViewModal = document.getElementById('closeViewModal');
        const editModal = document.getElementById('editModal');
        const closeEditModal = document.getElementById('closeEditModal');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const saveEditBtn = document.getElementById('saveEditBtn');
        const dashboardTitle = document.getElementById('dashboardTitle');
        
        // Stats elements
        const totalVideosEl = document.getElementById('totalVideos');
        const publicVideosEl = document.getElementById('publicVideos');
        const hiddenVideosEl = document.getElementById('hiddenVideos');
        const totalViewsEl = document.getElementById('totalViews');
        
        // View Modal elements
        const viewModalTitle = document.getElementById('viewModalTitle');
        const viewModalVideo = document.getElementById('viewModalVideo');
        const viewModalCategory = document.getElementById('viewModalCategory');
        const viewModalStatus = document.getElementById('viewModalStatus');
        const viewModalViews = document.getElementById('viewModalViews');
        const viewModalDescription = document.getElementById('viewModalDescription');
        const viewModalDate = document.getElementById('viewModalDate');
        
        // Edit Modal elements
        const editVideoTitle = document.getElementById('editVideoTitle');
        const editVideoEmbedCode = document.getElementById('editVideoEmbedCode');
        const editVideoCategory = document.getElementById('editVideoCategory');
        const editVideoStatus = document.getElementById('editVideoStatus');
        const editModalMessage = document.getElementById('editModalMessage');
        
        // New elements for link preview
        const videoLinkOrEmbedCode = document.getElementById('videoLinkOrEmbedCode');
        const linkPreview = document.getElementById('linkPreview');
        const previewStatus = document.getElementById('previewStatus');
        const previewThumbnail = document.getElementById('previewThumbnail');
        const editLinkPreview = document.getElementById('editLinkPreview');
        const editPreviewStatus = document.getElementById('editPreviewStatus');

        // Current admin state
        let currentAdmin = null;
        let allVideos = [];
        let currentVideoOrder = [];
        let videoSnapshotUnsubscribe = null;
        let currentEditingVideoId = null;
        let currentYouTubePlayer = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            checkAuthState();
        });

        // Check authentication state
        function checkAuthState() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // User is signed in, check if they are admin/moderator
                    await checkAdminStatus(user);
                } else {
                    // No user is signed in
                    showLoginPage();
                }
            });
        }

        // Check if user is admin/moderator
        async function checkAdminStatus(user) {
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const userRole = userDoc.data().role;
                    const allowedRoles = ["admin", "moderator"];
                    
                    if (allowedRoles.includes(userRole)) {
                        // User is admin/moderator
                        currentAdmin = {
                            email: user.email,
                            uid: user.uid,
                            role: userRole,
                            loginTime: new Date().toISOString()
                        };
                        
                        // Store admin session in localStorage for consistency
                        localStorage.setItem('firebaseAdmin', JSON.stringify(currentAdmin));
                        
                        showDashboard();
                        loadVideos();
                        startRealtimeUpdates();
                        applyUserPermissions();
                    } else {
                        // User is not admin/moderator
                        await signOut(auth);
                        localStorage.removeItem('firebaseAdmin');
                        showLoginPage();
                        showMessage(loginMessage, 'Access denied. Admin or moderator privileges required for video management.', 'warning');
                    }
                } else {
                    // User document not found
                    await signOut(auth);
                    localStorage.removeItem('firebaseAdmin');
                    showLoginPage();
                }
            } catch (error) {
                console.error('Error checking admin status:', error);
                localStorage.removeItem('firebaseAdmin');
                showLoginPage();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            backToAdminBtn.addEventListener('click', redirectToAdminPanel);
            backToAdminBtn2.addEventListener('click', redirectToAdminPanel);
            logoutBtn.addEventListener('click', handleLogout);
            addVideoBtn.addEventListener('click', handleAddVideo);
            
            // Auto-detect YouTube link and show preview
            videoLinkOrEmbedCode.addEventListener('input', handleLinkInput);
            editVideoEmbedCode.addEventListener('input', handleEditLinkInput);
            
            closeViewModal.addEventListener('click', () => {
                viewModal.classList.add('hidden');
                // Destroy YouTube player if exists
                if (currentYouTubePlayer) {
                    currentYouTubePlayer.destroy();
                    currentYouTubePlayer = null;
                }
            });
            
            closeEditModal.addEventListener('click', () => {
                editModal.classList.add('hidden');
            });
            
            cancelEditBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
            });
            
            saveEditBtn.addEventListener('click', handleSaveEdit);
            
            // Close modal when clicking outside
            viewModal.addEventListener('click', (e) => {
                if (e.target === viewModal) {
                    viewModal.classList.add('hidden');
                    // Destroy YouTube player if exists
                    if (currentYouTubePlayer) {
                        currentYouTubePlayer.destroy();
                        currentYouTubePlayer = null;
                    }
                }
            });
            
            editModal.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    editModal.classList.add('hidden');
                }
            });
            
            // Touch optimization for buttons
            document.querySelectorAll('.btn, .action-btn').forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                });
            });
        }

        // Handle link input for preview
        function handleLinkInput() {
            const input = videoLinkOrEmbedCode.value.trim();
            if (!input) {
                linkPreview.classList.remove('active');
                return;
            }
            
            const videoId = extractYouTubeIdFromLink(input);
            if (videoId) {
                // Show preview
                linkPreview.classList.add('active');
                previewStatus.textContent = `YouTube video detected: ${videoId}`;
                previewStatus.style.color = 'var(--success-color)';
                
                // Show thumbnail if available
                previewThumbnail.innerHTML = `<img src="https://img.youtube.com/vi/${videoId}/mqdefault.jpg" alt="YouTube Thumbnail" style="width:100%; border-radius:5px;">`;
            } else if (input.includes('<iframe')) {
                // It's an embed code
                linkPreview.classList.add('active');
                previewStatus.textContent = 'Embed code detected';
                previewStatus.style.color = 'var(--success-color)';
                previewThumbnail.innerHTML = '';
            } else {
                // Not a valid YouTube link or embed code
                linkPreview.classList.add('active');
                previewStatus.textContent = 'Please enter a valid YouTube link or embed code';
                previewStatus.style.color = 'var(--danger-color)';
                previewThumbnail.innerHTML = '';
            }
        }

        // Handle edit link input for preview
        function handleEditLinkInput() {
            const input = editVideoEmbedCode.value.trim();
            if (!input) {
                editLinkPreview.classList.remove('active');
                return;
            }
            
            const videoId = extractYouTubeIdFromLink(input);
            if (videoId) {
                // Show preview
                editLinkPreview.classList.add('active');
                editPreviewStatus.textContent = `YouTube video detected: ${videoId}`;
                editPreviewStatus.style.color = 'var(--success-color)';
            } else if (input.includes('<iframe')) {
                // It's an embed code
                editLinkPreview.classList.add('active');
                editPreviewStatus.textContent = 'Embed code detected';
                editPreviewStatus.style.color = 'var(--success-color)';
            } else {
                // Not a valid YouTube link or embed code
                editLinkPreview.classList.add('active');
                editPreviewStatus.textContent = 'Please enter a valid YouTube link or embed code';
                editPreviewStatus.style.color = 'var(--danger-color)';
            }
        }

        // Extract YouTube ID from link
        function extractYouTubeIdFromLink(link) {
            let videoId = null;
            
            // Trim and clean the link
            link = link.trim();
            
            // Check for youtu.be format
            if (link.includes('youtu.be/')) {
                const match = link.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);
                if (match && match[1]) {
                    videoId = match[1];
                }
            }
            
            // Check for youtube.com/watch?v= format
            else if (link.includes('youtube.com/watch')) {
                const match = link.match(/v=([a-zA-Z0-9_-]{11})/);
                if (match && match[1]) {
                    videoId = match[1];
                }
            }
            
            // Check for youtube.com/embed/ format
            else if (link.includes('youtube.com/embed/')) {
                const match = link.match(/embed\/([a-zA-Z0-9_-]{11})/);
                if (match && match[1]) {
                    videoId = match[1];
                }
            }
            
            // Check for YouTube short links
            else if (link.includes('youtube.com/shorts/')) {
                const match = link.match(/shorts\/([a-zA-Z0-9_-]{11})/);
                if (match && match[1]) {
                    videoId = match[1];
                }
            }
            
            // Check if it's just a video ID (11 characters)
            else if (/^[a-zA-Z0-9_-]{11}$/.test(link)) {
                videoId = link;
            }
            
            return videoId;
        }

        // Convert YouTube link to embed code
        function convertToEmbedCode(input) {
            // If it's already an embed code, return as is
            if (input.includes('<iframe')) {
                return input;
            }
            
            // Extract YouTube ID
            const videoId = extractYouTubeIdFromLink(input);
            
            if (videoId) {
                // Create embed code
                return `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            }
            
            return null;
        }

        // Redirect to admin panel
        function redirectToAdminPanel() {
            window.location.href = 'admin.html';
        }

        // Logout handler
        async function handleLogout() {
            if (videoSnapshotUnsubscribe) {
                videoSnapshotUnsubscribe();
            }
            
            // Destroy YouTube player if exists
            if (currentYouTubePlayer) {
                currentYouTubePlayer.destroy();
                currentYouTubePlayer = null;
            }
            
            // Sign out from Firebase
            await signOut(auth);
            localStorage.removeItem('firebaseAdmin');
            currentAdmin = null;
            showLoginPage();
        }

        // Add video handler
        async function handleAddVideo() {
            const title = document.getElementById('videoTitle').value.trim();
            const linkOrCode = document.getElementById('videoLinkOrEmbedCode').value.trim();
            const category = document.getElementById('videoCategory').value.trim();
            const status = document.getElementById('videoStatus').value;
            
            // Clear previous messages
            dashboardMessage.className = 'message';
            dashboardMessage.textContent = '';
            dashboardMessage.style.display = 'none';
            
            // Validate inputs
            if (!title) {
                showMessage(dashboardMessage, 'Please enter video title', 'error');
                return;
            }
            
            if (!linkOrCode) {
                showMessage(dashboardMessage, 'Please enter YouTube link or embed code', 'error');
                return;
            }
            
            // Convert link to embed code if needed
            const embedCode = convertToEmbedCode(linkOrCode);
            if (!embedCode) {
                showMessage(dashboardMessage, 'Please enter a valid YouTube link or embed code', 'error');
                return;
            }
            
            try {
                addVideoBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
                addVideoBtn.disabled = true;
                
                // Generate a unique ID for the video
                const videoId = 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Calculate order (last order + 1)
                const currentOrder = allVideos.length > 0 ? 
                    Math.max(...allVideos.map(v => v.order || 0)) + 1 : 1;
                
                // Save video data to Firestore
                const videoData = {
                    id: videoId,
                    title: title,
                    embedCode: embedCode,
                    category: category || 'Uncategorized',
                    status: status,
                    order: currentOrder,
                    views: 0,
                    addedBy: currentAdmin.email,
                    addedByRole: currentAdmin.role,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };
                
                await setDoc(doc(db, 'videos', videoId), videoData);
                
                // Clear form
                document.getElementById('videoTitle').value = '';
                document.getElementById('videoLinkOrEmbedCode').value = '';
                document.getElementById('videoCategory').value = '';
                linkPreview.classList.remove('active');
                
                // Show success message
                showMessage(dashboardMessage, `Video "${title}" added successfully!`, 'success');
                
            } catch (error) {
                console.error('Add video error:', error);
                showMessage(dashboardMessage, 'Failed to add video. Please try again.', 'error');
            } finally {
                addVideoBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Video';
                addVideoBtn.disabled = false;
            }
        }

        // Apply user permissions based on role
        function applyUserPermissions() {
            if (!currentAdmin) return;
            
            const userRole = currentAdmin.role;
            
            // Update dashboard title and role display
            if (userRole === 'admin') {
                dashboardTitle.textContent = 'Video Management - Admin';
                adminRoleDisplay.textContent = '(Admin)';
                adminRoleDisplay.style.color = '#4361ee';
            } else if (userRole === 'moderator') {
                dashboardTitle.textContent = 'Video Management - Moderator';
                adminRoleDisplay.textContent = '(Moderator)';
                adminRoleDisplay.style.color = '#4cc9f0';
            }
            
            adminEmail.textContent = currentAdmin.email;
        }

        // Load videos from Firestore
        async function loadVideos() {
            try {
                const q = query(collection(db, 'videos'), orderBy('order', 'asc'));
                const querySnapshot = await getDocs(q);
                allVideos = [];
                querySnapshot.forEach((doc) => {
                    const videoData = doc.data();
                    allVideos.push({ 
                        id: doc.id, 
                        ...videoData,
                        // Convert Firestore timestamp to Date if needed
                        createdAt: videoData.createdAt ? videoData.createdAt.toDate() : null,
                        updatedAt: videoData.updatedAt ? videoData.updatedAt.toDate() : null
                    });
                });
                
                updateStats(allVideos);
                renderVideos(allVideos);
            } catch (error) {
                console.error('Error loading videos:', error);
                videosContainer.innerHTML = '<div class="no-video" style="padding: 40px; grid-column: 1/-1;"><h3>Error loading videos</h3><p>Please try again later.</p></div>';
            }
        }

        // Start realtime updates
        function startRealtimeUpdates() {
            if (videoSnapshotUnsubscribe) {
                videoSnapshotUnsubscribe();
            }
            
            const q = query(collection(db, 'videos'), orderBy('order', 'asc'));
            
            videoSnapshotUnsubscribe = onSnapshot(q, (snapshot) => {
                allVideos = [];
                snapshot.forEach((doc) => {
                    const videoData = doc.data();
                    allVideos.push({ 
                        id: doc.id, 
                        ...videoData,
                        // Convert Firestore timestamp to Date if needed
                        createdAt: videoData.createdAt ? videoData.createdAt.toDate() : null,
                        updatedAt: videoData.updatedAt ? videoData.updatedAt.toDate() : null
                    });
                });
                
                updateStats(allVideos);
                renderVideos(allVideos);
            });
        }

        // Update statistics
        function updateStats(videos) {
            const totalVideos = videos.length;
            const publicVideos = videos.filter(v => v.status === 'public').length;
            const hiddenVideos = videos.filter(v => v.status === 'hidden').length;
            
            // Calculate total views
            let totalViews = 0;
            videos.forEach(video => {
                totalViews += video.views || 0;
            });
            
            totalVideosEl.textContent = totalVideos;
            publicVideosEl.textContent = publicVideos;
            hiddenVideosEl.textContent = hiddenVideos;
            totalViewsEl.textContent = totalViews;
        }

        // Render videos
        function renderVideos(videos) {
            if (videos.length === 0) {
                videosContainer.innerHTML = '';
                noVideosMessage.classList.remove('hidden');
                return;
            }
            
            noVideosMessage.classList.add('hidden');
            videosContainer.innerHTML = '';
            
            // Save current order for drag and drop
            currentVideoOrder = videos.map(v => v.id);
            
            videos.forEach((video, index) => {
                const card = document.createElement('div');
                card.className = `video-card ${video.status === 'hidden' ? 'hidden-video' : ''}`;
                card.setAttribute('data-video-id', video.id);
                card.setAttribute('draggable', 'true');
                
                // Format the timestamp
                let createdAt = 'N/A';
                if (video.createdAt) {
                    const date = video.createdAt instanceof Date ? video.createdAt : video.createdAt.toDate();
                    createdAt = date.toLocaleDateString();
                }
                
                // Extract YouTube video ID for thumbnail
                const youtubeId = extractYouTubeId(video.embedCode);
                const thumbnailUrl = youtubeId ? `https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg` : '';
                
                // Status badge
                const statusBadge = video.status === 'public' ? 
                    `<span class="video-card-status badge-public">Public</span>` : 
                    `<span class="video-card-status badge-hidden">Hidden</span>`;
                
                // Move buttons disabled state
                const moveUpDisabled = index === 0 ? 'disabled' : '';
                const moveDownDisabled = index === videos.length - 1 ? 'disabled' : '';
                
                card.innerHTML = `
                    <div class="sortable-handle">
                        <i class="fas fa-arrows-alt"></i> Drag
                    </div>
                    <div class="video-card-header">
                        <h4>${video.title || 'Untitled Video'}</h4>
                        ${statusBadge}
                    </div>
                    <div class="video-card-content">
                        <div class="video-preview">
                            ${thumbnailUrl ? 
                                `<img src="${thumbnailUrl}" alt="${video.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;">` :
                                `<div class="no-video">
                                    <i class="fas fa-video"></i>
                                    <p>Video Preview</p>
                                </div>`
                            }
                        </div>
                        <div class="video-meta">
                            <div class="video-meta-item">
                                <i class="fas fa-calendar"></i>
                                <span>Added: ${createdAt}</span>
                            </div>
                            <div class="video-meta-item">
                                <i class="fas fa-eye"></i>
                                <span>Views: ${video.views || 0}</span>
                            </div>
                            <div class="video-meta-item">
                                <i class="fas fa-tag"></i>
                                <span>Category: ${video.category || 'Uncategorized'}</span>
                            </div>
                            <div class="video-meta-item">
                                <i class="fas fa-sort-numeric-down"></i>
                                <span>Order: ${video.order || index + 1}</span>
                            </div>
                        </div>
                        <div class="video-actions">
                            <button class="action-btn btn-view" data-video-id="${video.id}">
                                <i class="fas fa-play"></i> View
                            </button>
                            <button class="action-btn btn-edit" data-video-id="${video.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            ${video.status === 'public' ? 
                                `<button class="action-btn btn-hide" data-video-id="${video.id}">
                                    <i class="fas fa-eye-slash"></i> Hide
                                </button>` : 
                                `<button class="action-btn btn-show" data-video-id="${video.id}">
                                    <i class="fas fa-eye"></i> Show
                                </button>`
                            }
                            <button class="action-btn btn-move" data-video-id="${video.id}" data-direction="up" ${moveUpDisabled}>
                                <i class="fas fa-arrow-up"></i> Up
                            </button>
                            <button class="action-btn btn-move" data-video-id="${video.id}" data-direction="down" ${moveDownDisabled}>
                                <i class="fas fa-arrow-down"></i> Down
                            </button>
                            <button class="action-btn btn-danger" data-video-id="${video.id}" data-video-title="${video.title}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
                
                videosContainer.appendChild(card);
            });
            
            // Add event listeners to action buttons
            addVideoActionListeners();
            
            // Initialize drag and drop
            initializeDragAndDrop();
        }

        // Add event listeners to video action buttons
        function addVideoActionListeners() {
            // View buttons
            document.querySelectorAll('.btn-view').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const videoId = e.currentTarget.getAttribute('data-video-id');
                    const video = allVideos.find(v => v.id === videoId);
                    
                    if (video) {
                        await showVideoModal(video);
                        
                        // Increment view count
                        await updateDoc(doc(db, 'videos', videoId), {
                            views: (video.views || 0) + 1,
                            lastViewed: new Date().toISOString()
                        });
                    }
                });
            });
            
            // Edit buttons
            document.querySelectorAll('.btn-edit').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const videoId = e.currentTarget.getAttribute('data-video-id');
                    const video = allVideos.find(v => v.id === videoId);
                    
                    if (video) {
                        showEditModal(video);
                    }
                });
            });
            
            // Hide/Show buttons
            document.querySelectorAll('.btn-hide, .btn-show').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const videoId = e.currentTarget.getAttribute('data-video-id');
                    const video = allVideos.find(v => v.id === videoId);
                    
                    if (video) {
                        const newStatus = video.status === 'public' ? 'hidden' : 'public';
                        
                        try {
                            await updateDoc(doc(db, 'videos', videoId), {
                                status: newStatus,
                                updatedAt: serverTimestamp()
                            });
                            
                            showMessage(dashboardMessage, 
                                `Video "${video.title}" is now ${newStatus === 'public' ? 'public' : 'hidden'}!`, 
                                'success');
                        } catch (error) {
                            console.error('Error updating video status:', error);
                            showMessage(dashboardMessage, 'Failed to update video status', 'error');
                        }
                    }
                });
            });
            
            // Move buttons
            document.querySelectorAll('.btn-move:not(:disabled)').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const videoId = e.currentTarget.getAttribute('data-video-id');
                    const direction = e.currentTarget.getAttribute('data-direction');
                    
                    await moveVideo(videoId, direction);
                });
            });
            
            // Delete buttons
            document.querySelectorAll('.btn-danger').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const videoId = e.currentTarget.getAttribute('data-video-id');
                    const videoTitle = e.currentTarget.getAttribute('data-video-title');
                    const video = allVideos.find(v => v.id === videoId);
                    
                    if (video && confirm(`Are you sure you want to delete video "${videoTitle}"? This action cannot be undone.`)) {
                        try {
                            await deleteDoc(doc(db, 'videos', videoId));
                            
                            // Reorder remaining videos
                            await reorderVideosAfterDelete();
                            
                            showMessage(dashboardMessage, 
                                `Video "${videoTitle}" has been deleted!`, 
                                'success');
                        } catch (error) {
                            console.error('Error deleting video:', error);
                            showMessage(dashboardMessage, 'Failed to delete video', 'error');
                        }
                    }
                });
            });
        }

        // Initialize drag and drop
        function initializeDragAndDrop() {
            const videoCards = document.querySelectorAll('.video-card');
            
            videoCards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('dragenter', handleDragEnter);
                card.addEventListener('dragleave', handleDragLeave);
                card.addEventListener('drop', handleDrop);
                card.addEventListener('dragend', handleDragEnd);
            });
        }

        let draggedCard = null;

        function handleDragStart(e) {
            draggedCard = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.getAttribute('data-video-id'));
            setTimeout(() => {
                this.classList.add('sortable-ghost');
            }, 0);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('sortable-chosen');
        }

        function handleDragLeave() {
            this.classList.remove('sortable-chosen');
        }

        async function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('sortable-chosen');
            
            if (draggedCard !== this) {
                const draggedId = draggedCard.getAttribute('data-video-id');
                const targetId = this.getAttribute('data-video-id');
                
                // Swap the order of the two videos
                await swapVideoOrder(draggedId, targetId);
            }
        }

        function handleDragEnd() {
            this.classList.remove('sortable-ghost');
            document.querySelectorAll('.video-card').forEach(card => {
                card.classList.remove('sortable-chosen');
            });
            draggedCard = null;
        }

        // Swap video order
        async function swapVideoOrder(videoId1, videoId2) {
            const video1 = allVideos.find(v => v.id === videoId1);
            const video2 = allVideos.find(v => v.id === videoId2);
            
            if (!video1 || !video2) return;
            
            try {
                // Swap order values
                const tempOrder = video1.order;
                
                await updateDoc(doc(db, 'videos', videoId1), {
                    order: video2.order,
                    updatedAt: serverTimestamp()
                });
                
                await updateDoc(doc(db, 'videos', videoId2), {
                    order: tempOrder,
                    updatedAt: serverTimestamp()
                });
                
                showMessage(dashboardMessage, 'Video order updated!', 'success');
            } catch (error) {
                console.error('Error swapping video order:', error);
                showMessage(dashboardMessage, 'Failed to update video order', 'error');
            }
        }

        // Move video up or down
        async function moveVideo(videoId, direction) {
            const videoIndex = allVideos.findIndex(v => v.id === videoId);
            if (videoIndex === -1) return;
            
            let targetIndex;
            if (direction === 'up' && videoIndex > 0) {
                targetIndex = videoIndex - 1;
            } else if (direction === 'down' && videoIndex < allVideos.length - 1) {
                targetIndex = videoIndex + 1;
            } else {
                return;
            }
            
            const targetVideoId = allVideos[targetIndex].id;
            await swapVideoOrder(videoId, targetVideoId);
        }

        // Reorder videos after delete
        async function reorderVideosAfterDelete() {
            try {
                // Get all videos again to ensure we have the latest data
                const q = query(collection(db, 'videos'), orderBy('order', 'asc'));
                const querySnapshot = await getDocs(q);
                const videos = [];
                
                querySnapshot.forEach((doc) => {
                    videos.push({ id: doc.id, ...doc.data() });
                });
                
                // Update order sequentially
                for (let i = 0; i < videos.length; i++) {
                    const video = videos[i];
                    if (video.order !== i + 1) {
                        await updateDoc(doc(db, 'videos', video.id), {
                            order: i + 1,
                            updatedAt: serverTimestamp()
                        });
                    }
                }
            } catch (error) {
                console.error('Error reordering videos:', error);
            }
        }

        // Extract YouTube ID from embed code
        function extractYouTubeId(embedCode) {
            if (!embedCode) return null;
            
            // Check for youtube.com/embed/ format
            const embedMatch = embedCode.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/);
            if (embedMatch && embedMatch[1]) {
                return embedMatch[1];
            }
            
            // Check for youtu.be/ format
            const shortMatch = embedCode.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);
            if (shortMatch && shortMatch[1]) {
                return shortMatch[1];
            }
            
            // Check for v= parameter
            const paramMatch = embedCode.match(/v=([a-zA-Z0-9_-]{11})/);
            if (paramMatch && paramMatch[1]) {
                return paramMatch[1];
            }
            
            return null;
        }

        // Show video in modal - FIXED VERSION
        async function showVideoModal(video) {
            viewModalTitle.textContent = video.title;
            
            // Extract YouTube ID
            const youtubeId = extractYouTubeId(video.embedCode);
            
            if (youtubeId) {
                viewModalVideo.innerHTML = `
                    <div id="youtubePlayerContainer" style="width:100%; height:100%; position:relative;">
                        <div id="youtubePlayer"></div>
                        <button id="unmuteBtn" class="unmute-button">
                            <i class="fas fa-volume-mute"></i>   
                        </button>
                        <div id="soundMessage" class="sound-message">
                            <i class="fas fa-info-circle"></i>            
                        </div>
                    </div>
                `;
                
                viewModal.classList.remove('hidden');
                
                // Load YouTube IFrame API if not already loaded
                if (!window.YT) {
                    const tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    const firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                    
                    // Wait for API to load
                    await new Promise((resolve) => {
                        window.onYouTubeIframeAPIReady = () => {
                            resolve();
                        };
                        
                        // If API is already loaded
                        setTimeout(() => {
                            if (window.YT && window.YT.Player) {
                                resolve();
                            }
                        }, 1000);
                    });
                }
                
                // Give a small delay for DOM to update
                setTimeout(() => {
                    // Create YouTube player - START WITH MUTED
                    currentYouTubePlayer = new YT.Player('youtubePlayer', {
                        height: '100%',
                        width: '100%',
                        videoId: youtubeId,
                        playerVars: {
                            'autoplay': 1,
                            'controls': 1,
                            'rel': 0,
                            'modestbranding': 1,
                            'playsinline': 1,
                            'mute': 1, // Start muted to allow autoplay
                            'enablejsapi': 1
                        },
                        events: {
                            'onReady': (event) => {
                                console.log('YouTube player is ready');
                            },
                            'onStateChange': (event) => {
                                console.log('Player state changed:', event.data);
                            }
                        }
                    });
                    
                    // Setup unmute button
                    document.getElementById('unmuteBtn').addEventListener('click', () => {
                        if (currentYouTubePlayer) {
                            currentYouTubePlayer.unMute();
                            currentYouTubePlayer.setVolume(100);
                            document.getElementById('unmuteBtn').innerHTML = '<i class="fas fa-volume-up"></i>   ';
                            document.getElementById('unmuteBtn').style.backgroundColor = 'rgba(76, 201, 240, 0.9)';
                            document.getElementById('soundMessage').style.display = 'none';
                            
                            // Change button text after 2 seconds
                            setTimeout(() => {
                                document.getElementById('unmuteBtn').innerHTML = '<i class="fas fa-volume-up"></i>   ';
                            }, 2000);
                        }
                    });
                    
                    // Hide sound message after 10 seconds
                    setTimeout(() => {
                        const soundMessage = document.getElementById('soundMessage');
                        if (soundMessage) {
                            soundMessage.style.display = 'none';
                        }
                    }, 10000);
                }, 100);
            } else {
                viewModalVideo.innerHTML = '<p>No video available</p>';
                viewModal.classList.remove('hidden');
            }
            
            viewModalCategory.textContent = video.category || 'Uncategorized';
            viewModalStatus.textContent = video.status === 'public' ? 'Public' : 'Hidden';
            viewModalStatus.className = video.status === 'public' ? 'badge badge-public' : 'badge badge-hidden';
            viewModalViews.textContent = video.views || 0;
            viewModalDescription.textContent = video.description || 'No description available.';
            
            if (video.createdAt) {
                const date = video.createdAt instanceof Date ? video.createdAt : video.createdAt.toDate();
                viewModalDate.textContent = date.toLocaleDateString();
            } else {
                viewModalDate.textContent = 'Unknown';
            }
        }

        // Show edit modal
        function showEditModal(video) {
            currentEditingVideoId = video.id;
            editVideoTitle.value = video.title || '';
            editVideoEmbedCode.value = video.embedCode || '';
            editVideoCategory.value = video.category || '';
            editVideoStatus.value = video.status || 'public';
            
            // Clear previous messages
            editModalMessage.className = 'message';
            editModalMessage.textContent = '';
            editModalMessage.style.display = 'none';
            
            editModal.classList.remove('hidden');
        }

        // Handle save edit
        async function handleSaveEdit() {
            const title = editVideoTitle.value.trim();
            const linkOrCode = editVideoEmbedCode.value.trim();
            const category = editVideoCategory.value.trim();
            const status = editVideoStatus.value;
            
            // Validate inputs
            if (!title) {
                showMessage(editModalMessage, 'Please enter video title', 'error');
                return;
            }
            
            if (!linkOrCode) {
                showMessage(editModalMessage, 'Please enter YouTube link or embed code', 'error');
                return;
            }
            
            // Convert link to embed code if needed
            const embedCode = convertToEmbedCode(linkOrCode);
            if (!embedCode) {
                showMessage(editModalMessage, 'Please enter a valid YouTube link or embed code', 'error');
                return;
            }
            
            try {
                saveEditBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveEditBtn.disabled = true;
                
                await updateDoc(doc(db, 'videos', currentEditingVideoId), {
                    title: title,
                    embedCode: embedCode,
                    category: category || 'Uncategorized',
                    status: status,
                    updatedAt: serverTimestamp()
                });
                
                // Close modal
                editModal.classList.add('hidden');
                
                // Show success message
                showMessage(dashboardMessage, `Video "${title}" updated successfully!`, 'success');
                
            } catch (error) {
                console.error('Error updating video:', error);
                showMessage(editModalMessage, 'Failed to update video. Please try again.', 'error');
            } finally {
                saveEditBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                saveEditBtn.disabled = false;
            }
        }

        // Show dashboard
        function showDashboard() {
            loadingSection.classList.add('hidden');
            loginSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
        }

        // Show login page
        function showLoginPage() {
            loadingSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
        }

        // Show message function
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `message message-${type}`;
            element.style.display = 'flex';
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>
