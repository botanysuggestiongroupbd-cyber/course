<!DOCTYPE html>
<html lang="en">
<<head>
  <meta charset="UTF-8">
  <title>Fourth Year Course</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
</head>
<body>
  <div id="player" data-plyr-provider="youtube"></div>

  <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
  <script type="module">
    // Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { 
      getFirestore, 
      doc,
      getDoc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Firebase config (index.html এর মতোই)
    const firebaseConfig = {
      apiKey: "AIzaSyAJn31foXlB5ooSIdZ1aGcshMu955urDQo",
      authDomain: "fouth-year.firebaseapp.com",
      projectId: "fouth-year",
      storageBucket: "fouth-year.firebasestorage.app",
      messagingSenderId: "771603556892",
      appId: "1:771603556892:web:51ae0bd68acf6678a14dd9",
      measurementId: "G-XWWT64FGJR"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get Firestore video ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const firestoreVideoId = urlParams.get('videoId');
    
    // Load video from Firestore
    async function loadVideo() {
      if (!firestoreVideoId) {
        console.error('No video ID');
        return;
      }
      
      try {
        // Firestore থেকে ভিডিও ডাটা লোড করুন
        const videoRef = doc(db, 'videos', firestoreVideoId);
        const videoDoc = await getDoc(videoRef);
        
        if (!videoDoc.exists()) {
          console.error('Video not found');
          return;
        }
        
        const videoData = videoDoc.data();
        
        // YouTube ID এক্সট্র্যাক্ট করুন
        function extractYouTubeId(embedCode) {
          if (!embedCode) return null;
          const match = embedCode.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/) ||
                       embedCode.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/) ||
                       embedCode.match(/v=([a-zA-Z0-9_-]{11})/);
          return match ? match[1] : null;
        }
        
        const youtubeId = extractYouTubeId(videoData.embedCode);
        
        if (!youtubeId) {
          console.error('Invalid video');
          return;
        }
        
        // ভিউ কাউন্ট আপডেট করুন
        await updateDoc(videoRef, {
          views: (videoData.views || 0) + 1,
          lastViewed: serverTimestamp()
        });
        
        // প্লেয়ার সেটআপ করুন
        const playerElement = document.getElementById('player');
        playerElement.setAttribute('data-plyr-embed-id', youtubeId);
        
        // প্লেয়ার ইনিশিয়ালাইজ করুন
        const player = new Plyr('#player');
        
      } catch (error) {
        console.error('Error:', error);
      }
    }
    
    // Load when page loads
    document.addEventListener('DOMContentLoaded', loadVideo);
    
    // Disable right-click
    document.addEventListener('contextmenu', (e) => e.preventDefault());
  </script>
</body>
</html>
